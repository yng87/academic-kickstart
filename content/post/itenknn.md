---
title: "ItemKNN を使って MovieLens 学習"
date: 2020-09-04
lang: en-us
draft: true
---

# 概要

RecSys2019のベストペーパーや2020の再現性論文を読んで、ベースラインとなるような手法をきちんと実装・チューニングできることの重要性を感じている。

## 手法
ItemKNN はアイテムベースの協調フィルタリングであり、アイテムの類似度を元に似ているアイテムを $k$ 件抽出して推薦を行うアルゴリズムである。具体的には

1. アイテム $i$ と アイテム $j$ の (コサイン) 類似度を次で定義する：
$$
s_{ij} = \frac{\vec{r}_i\cdot\vec{r}_j}{|\vec{r}_i| |\vec{r}_j| + h}.
$$
$\vec{r}_i = (r_{i1}, \dots, r_{iN_u})$ はアイテム $i$ の特徴量ベクトルで、ここでは $r_{iu}$ がアイテム $i$ に対するユーザー $u$ の評価値を表すとする ($u = 1,\dots,N_u$)。
$h$ は shrink parameter と呼ばれ、$\vec{r}_i$ のノルムが小さい (=評価数が少ない) 時に類似度を下方修正する役割をする。

2. TF-IDF によって多くのアイテムに評価をつけるユーザーの寄与を抑える。計算は
$$
r_{iu} \to r_{iu}\times \left(\log\left( \frac{N_i}{\sum_{i: r_{ui}\neq0}1}\right) + 1\right)
$$
とする。$\log$の中の分母はユーザー $u$ が評価をつけたアイテムの総数を、$N_i$はアイテムの総数を表す。各ユーザーは各アイテムに一回しか評価をつけないので、TF項は入れていない。

3. ユーザー $u$ のアイテム $i$ に対する選好度のスコアは
$$
P_{ui} = \sum_{j \in kNN(i)} s_{ij}r_{uj}
$$
$j$の和はアイテム $i$ の近傍 $k$ 件だけ取ってくる。
そして、ユーザー $u$ への推薦は、$P_{ui}$ が大きい順に $n$ 個のアイテムを取ってくることで行う。

## 実験

MovieLens 1M で、rating=5 を positive (1)、rating<5 を negative (0) として上の ItemkNN 協調フィルタリングを実行した。

| Method                | Recall＠20  | Recall＠60|Recall＠100|
| -------------------   | ----------- |---       |---|
| k=200, h=0, w/ TF-IDF |0.2773       |0.4641|0.5647|
| k=200, h=0, w/o TF-IDF|0.2704       |0.4537|0.5533|
| 参考値|0.2819|0.4712|0.5737|

上二つと最後の段の参考値はデータセットの分割が違うので、数字をそのまま比較することはできないが、大体近い値になっている。